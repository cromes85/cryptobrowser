<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cours Crypto</title>
<style>
    body {
        background-color: white;
        color: black;
        font-family: Arial, sans-serif;
        text-align: center;
        padding-top: 50px;
    }
    .crypto {
        font-size: 80px;
        font-weight: bold;
        margin: 25px 0;
    }
    #lastUpdate {
        margin-top: 30px;
        font-size: 18px;
        color: gray;
    }
</style>
</head>
<body>
<h1>Cours Crypto</h1>
<div id="cryptoContainer">Chargement...</div>
<div id="lastUpdate">Dernière synchro : en attente...</div>

<script>
let useFallback = false;
let failCount = 0;
const maxFails = 5;

async function getCoinRanking() {
    const proxy = "https://api.allorigins.win/get?url=";
    const api = "https://api.coinranking.com/v2/coins?symbols=XRP,VELO,NANO";
    const res = await fetch(proxy + encodeURIComponent(api));
    const data = await res.json();
    const coins = JSON.parse(data.contents).data.coins;
    const find = s => coins.find(c => c.symbol === s)?.price ?? "N/A";
    return {
        XRP: parseFloat(find("XRP")).toFixed(6),
        VELO: parseFloat(find("VELO")).toFixed(6),
        NANO: parseFloat(find("NANO")).toFixed(6)
    };
}

async function getCoinGecko() {
    const url = "https://api.coingecko.com/api/v3/simple/price?ids=ripple,velo,nano&vs_currencies=usd";
    const res = await fetch(url);
    const data = await res.json();
    return {
        XRP: data.ripple?.usd ?? "N/A",
        VELO: data.velo?.usd ?? "N/A",
        NANO: data.nano?.usd ?? "N/A"
    };
}

async function updateCryptoPrices() {
    try {
        const prices = useFallback ? await getCoinGecko() : await getCoinRanking();
        document.getElementById("cryptoContainer").innerHTML = `
            <div class="crypto">XRP : ${prices.XRP} USD</div>
            <div class="crypto">VELO : ${prices.VELO} USD</div>
            <div class="crypto">NANO : ${prices.NANO} USD</div>
        `;
        document.getElementById("lastUpdate").innerText =
            "Dernière synchro : " + new Date().toLocaleString();
        failCount = 0;
    } catch (err) {
        console.error("Erreur API:", err);
        failCount++;
        if (!useFallback && failCount >= maxFails) {
            useFallback = true;
            console.warn("Basculé sur CoinGecko (fallback).");
        }
        document.getElementById("cryptoContainer").innerText = "Erreur de récupération des données";
    }
}

updateCryptoPrices();
setInterval(updateCryptoPrices, 30000);
</script>
</body>
</html>
