<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cours Crypto - Compatibilité iOS9</title>
<style>
    body {
        background-color: black;
        color: white;
        font-family: Arial, sans-serif;
        text-align: center;
        margin: 0;
        padding: 10px;
    }
    h1 {
        font-size: 28px;
        margin-bottom: 15px;
    }
    .crypto {
        font-size: 60px;
        font-weight: bold;
        margin: 8px 0 10px 0;
    }
    .source {
        font-size: 24px;
        color: #ccc;
        margin-bottom: 20px;
    }
    #lastUpdate {
        margin-top: 30px;
        font-size: 20px;
        color: #888;
    }
</style>
</head>
<body>
    <h1>Cours Crypto</h1>
    <div id="cryptoData">Chargement...</div>
    <div id="lastUpdate">Dernière synchro : en attente...</div>

<script>
function httpGet(url, callback){
    var xhr = new XMLHttpRequest();
    xhr.open("GET", url, true);
    xhr.onreadystatechange = function(){
        if(xhr.readyState === 4){
            if(xhr.status === 200){
                callback(null, JSON.parse(xhr.responseText));
            } else {
                callback(xhr.status);
            }
        }
    };
    xhr.send();
}

function updatePrices(){
    var container = document.getElementById("cryptoData");
    container.innerHTML = "Chargement...";

    // --- COINGECKO ---
    httpGet("https://api.coingecko.com/api/v3/simple/price?ids=ripple,velodrome-finance,nano&vs_currencies=usd", function(err, data1){
        if(err){container.innerHTML="Erreur CoinGecko"; return;}
        
        // --- COINRANKING ---
        httpGet("https://api.coinranking.com/v2/coins?symbols=XRP,VELO,NANO", function(err2, data2){
            var html = "";

            // XRP
            var xrpCG = data1.ripple.usd;
            var veloCG = data1["velodrome-finance"] ? data1["velodrome-finance"].usd : "N/A";
            var nanoCG = data1.nano.usd;

            var coins = (data2 && data2.data && data2.data.coins) ? data2.data.coins : [];
            function findPrice(symbol){
                for(var i=0;i<coins.length;i++){
                    if(coins[i].symbol===symbol) return parseFloat(coins[i].price).toFixed(6);
                }
                return "N/A";
            }

            var xrpCR = findPrice("XRP");
            var veloCR = findPrice("VELO");
            var nanoCR = findPrice("NANO");

            
            html += '<div class="crypto">XRP : '+xrpCG+' USD</div><div class="source">CoinGecko</div><hr>';
            html += '<div class="crypto">VELO : '+veloCG+' USD</div><div class="source">CoinGecko</div><hr>';
            html += '<div class="crypto">NANO : '+nanoCG+' USD</div><div class="source">CoinGecko</div>';

            container.innerHTML = html;

            var now = new Date();
            document.getElementById("lastUpdate").innerText = 
                "Dernière synchro : " + now.toLocaleDateString() + " " + now.toLocaleTimeString();
        });
    });
}

updatePrices();
setInterval(updatePrices, 25000);
</script>
</body>
</html>
